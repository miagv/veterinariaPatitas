<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/citas.css}">
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <title>Simulador de Citas - Veterinaria Patitas</title>
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          crossorigin="anonymous">
    <!-- Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
</head>
<body>
<header>
         <div th:replace="fragments/navbar :: navbar"></div>
    </header>
    <div id="app" class="container-fluid">
        <div class="main-content-box mx-auto p-4 p-md-5 my-5" style="max-width: 1000px;">
        
            <header class="text-center mb-5 pb-3 border-bottom">
                <h1 class="display-6 fw-bolder text-dark text-uppercase">Agendamiento de Citas</h1>
                <p class="lead text-secondary mt-2">Disponibilidad de Servicios Veterinarios</p>
            </header>
            
            <!-- Mensaje de Notificación (Éxito o Error de Disponibilidad) -->
            <div th:if="${message}" id="notification" 
                 th:classappend="|alert-${messageType}|"
                 class="alert mx-auto mb-4" role="alert">
                <p th:text="${message}" class="mb-0 fw-bold"></p>
            </div>

            <div class="row">
                
                <!-- Columna 1: Formulario de Agendamiento -->
                <section class="col-lg-6 mb-5">
                    <h2 class="h5 fw-bold mb-4 text-secondary"><i class="fa-solid fa-calendar-check me-2 text-patitas"></i>Solicitar una Cita</h2>
                    
                    <form th:action="@{/book_appointment}" method="post" class="p-4 border rounded-3 shadow-sm">
                        
                        <!-- Campo Cliente -->
                        <div class="mb-3">
                            <label for="clientName" class="form-label fw-semibold">Nombre</label>
                            <input type="text" class="form-control" id="clientName" name="clientName" required>
                        </div>

                        <!-- Campo Servicio -->
                        <div class="mb-3">
                            <label for="serviceId" class="form-label fw-semibold">Servicio Requerido</label>
                            <select id="serviceId" name="serviceId" class="form-select" required>
                                <option value="">Seleccione un servicio</option>
                                <option th:each="service : ${availableServices}" 
                                        th:value="${service.id}"
                                        th:text="${service.name} + ' (' + ${service.duration} + ' - S/. ' + ${#numbers.formatDecimal(service.price, 1, 2)} + ')'">
                                    Consulta General (30 min - S/. 50.00)
                                </option>
                            </select>
                        </div>
                        
                        <div class="row">
                            <!-- Campo Fecha -->
                            <div class="col-md-6 mb-3">
                                <label for="date" class="form-label fw-semibold">Fecha</label>
                                <input type="date" class="form-control" id="date" name="date" 
                                       th:min="${minDate}" required>
                            </div>

                            <!-- Campo Hora -->
                            <div class="col-md-6 mb-3">
                                <label for="time" class="form-label fw-semibold">Hora</label>
                                <!-- Horarios de ejemplo: 9:00, 10:00, 11:00, 14:00, 15:00, 16:00 -->
                                <select id="time" name="time" class="form-select" required>
                                    <option value="">Seleccione hora</option>
                                    <option value="09:00">09:00 AM</option>
                                    <option value="10:00">10:00 AM</option>
                                    <option value="11:00">11:00 AM</option>
                                    <option value="14:00">02:00 PM</option>
                                    <option value="15:00">03:00 PM</option>
                                    <option value="16:00">04:00 PM</option>
                                </select>
                            </div>
                        </div>

                        <button type="submit" class="w-100 btn btn-patitas fw-bold py-2 mt-3">
                            <i class="fa-solid fa-calendar-plus me-2"></i>
                            Agendar Cita
                        </button>
                    </form>
                </section>

                <!-- Columna 2: Citas Agendadas -->
                <aside class="col-lg-6">
                    <h2 class="h5 fw-bold mb-4 text-secondary"><i class="fa-solid fa-calendar-alt me-2 text-warning"></i>Citas Ocupadas</h2>
                    
                    <div th:if="${#lists.isEmpty(bookedAppointments)}" class="alert alert-info text-center">
                        No hay citas agendadas aún.
                    </div>

                    <div th:unless="${#lists.isEmpty(bookedAppointments)}">
                        <ul class="list-group">
                            <li th:each="appointment : ${bookedAppointments}" 
                                class="list-group-item d-flex justify-content-between align-items-center booked-item mb-2 shadow-sm">
                                
                                <div>
                                    <p class="fw-bold mb-0 text-dark" th:text="${appointment.service.name}"></p>
                                    <p class="text-sm text-muted mb-0" th:text="${appointment.clientName}"></p>
                                </div>
                                <div class="text-end">
                                    <!-- Formateamos la fecha y hora usando el objeto formatter del Modelo -->
                                    <span class="badge bg-warning text-dark p-2 fw-bold" 
                                          th:text="${#temporals.format(appointment.dateTime, 'dd-MM-yyyy')}"></span>
                                    <br>
                                    <span class="badge bg-patitas p-2 mt-1" 
                                          th:text="${#temporals.format(appointment.dateTime, 'HH:mm')}"></span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </aside>
            </div>

        </div>
    </div>
    
    <!-- Bootstrap 5 JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
            crossorigin="anonymous"></script>

</body>
</html>

